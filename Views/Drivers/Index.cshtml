@model IEnumerable<testing.Models.AdminManageModels.Driver>

@{
    ViewData["Title"] = "Index";
}

<h2>Index</h2>

<p>
    <a asp-action="Create">Create New</a>
</p>

<div class="input-group">
    <input type="text" id="myInput" class="form-control" placeholder="Search" onkeyup="myFunction()" title="Type in a name">
    <div class="input-group-btn">
        <button class="btn btn-default" type="submit">
            <i class="glyphicon glyphicon-search"></i>
        </button>
    </div>
</div>

<hr />

<div id="">
    <table class="table">
        <thead>
            <tr id="tr">
                <th>Bus Number</th>
                <th>User Name</th>
                <th>Email</th>
                <th>Phone Number</th>
                <th>Remove</th>
                <th>Update</th>
            </tr>
        </thead>
        <tbody id="detailsdata"></tbody>
    </table>
</div>

<script src="~/js/site.js"></script>

<script>

    // Create Reference

    var dbRef = firebase.database().ref().child('Driver');

    dbRef.once('value', function (snapshot) {
      
        snapshot.forEach(function (childSnapshot) {
           
            console.log(childSnapshot.key);
            console.log(childSnapshot.val());

            $('#detailsdata').append(contactHtmlFromObject(childSnapshot.key, childSnapshot.val()));
           
        });
    });

    function del(key) {
        
        dbRef.child(key).remove();
        location.reload();
    }

    function edit(key) {

        window.location.href = 'Drivers/edit?id=' + key;
        console.log(window.location.href);
    }

    //prepare conatct object' HTML
    function contactHtmlFromObject(key, contact) {

        var ourKey = key;
        console.log(ourKey);

        console.log(window.location.href);
        var html = '<tr>';
        html += '<td>' + contact.busnumber + '</td>';
        html += '<td>' + contact.username + '</td>';
        html += '<td>' + contact.email + '</td>';
        html += '<td>' + contact.phonenumber + '</td>';
        html += '<td><button type="button" class="btn btn-default" onClick="del(\'' + ourKey + '\')">Delete</button></td>';
        html += '<td><button type="button" class="btn btn-default" onClick="edit(\'' + ourKey + '\')">Edit</button></td>';
        html += '</tr>';
        return html;
    }


    function myFunction() {
        // Declare variables 
        var input, filter, table, tr, td, i;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        table = document.getElementById("detailsdata");
        tr = table.getElementsByTagName("tr");

        // Loop through all table rows, and hide those who don't match the search query
        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[0];
            if (td) {
                if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }

</script>